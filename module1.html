<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Module 1: What is the Internet?</title>
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      text-align: center;
    }

    h2 {
      margin-bottom: 10px;
    }

    #cloud {
      margin: 20px auto;
      width: 300px;
      height: 300px;
      border: 3px dashed #00bfff;
      border-radius: 50%;
      position: relative;
      background: #f0f8ff;
    }

    .draggable {
      width: 100px;
      padding: 10px;
      background: #007bff;
      color: white;
      margin: 10px;
      border-radius: 8px;
      cursor: grab;
      display: inline-block;
    }

    #description {
      margin-top: 20px;
      font-style: italic;
      min-height: 40px;
    }
  </style>
</head>
<body>

  <h2>Build the Internet!</h2>
  <p>Drag each network into the Internet Cloud to learn how they're all connected.</p>

  <div>
    <div class="draggable" data-name="home">🏠 Home</div>
    <div class="draggable" data-name="school">🏫 School</div>
    <div class="draggable" data-name="library">📚 Library</div>
    <div class="draggable" data-name="business">🏢 Business</div>
    <div class="draggable" data-name="datacenter">💾 Data Center</div>
  </div>

  <div id="cloud">🌐<br><small>Internet</small></div>

  <div id="description"></div>

  <div>
    <button onclick="completeModule(1)">Mark Complete & Go Home</button>
  </div>

  <script>
    const backendUrl = "https://cyberquestjava.onrender.com";

    const descriptions = {
      home: "Home networks connect families and personal devices to the internet.",
      school: "Schools use networks to let students learn, communicate, and access educational content.",
      library: "Libraries connect to the internet so anyone can research or browse online.",
      business: "Businesses rely on the internet to communicate, work remotely, and serve customers.",
      datacenter: "Data centers store and send information like websites, videos, and files across the world."
    };

    interact('.draggable')
      .draggable({
        inertia: true,
        modifiers: [
          interact.modifiers.restrictRect({ restriction: 'parent', endOnly: true })
        ],
        autoScroll: true,
        listeners: {
          move: dragMoveListener
        }
      });

    function dragMoveListener (event) {
      const target = event.target;
      const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
      const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

      target.style.transform = `translate(${x}px, ${y}px)`;
      target.setAttribute('data-x', x);
      target.setAttribute('data-y', y);
    }

    interact('#cloud').dropzone({
      accept: '.draggable',
      ondrop(event) {
        const name = event.relatedTarget.getAttribute('data-name');
        document.getElementById('description').textContent = descriptions[name];
        event.relatedTarget.style.opacity = 0.5;
        event.relatedTarget.style.pointerEvents = 'none'; // disable further dragging
      }
    });

    function completeModule(moduleIndex) {
        const username = localStorage.getItem("username");
        if (!username) {
        alert("No user logged in.");
        return;
        }

        fetch(`${backendUrl}/api/users/module`, {
            method: "PUT",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ username, moduleIndex})
        })
        .then(res => res.text())
        .then(data => {
            console.log("Response from backend:", data); //To log progress in the developer log (F12)
            if (data === "Module Updated Successfully") {
                window.location.href = "home.html";
            } else {
                alert(data);
            }
        })
        .catch(err => {
            console.error("Failed to update progress:", err);
            alert("Could not save progress.");
        });
    }
  </script>

</body>
</html>
